<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1104px" preserveAspectRatio="none" style="width:894px;height:1104px;" version="1.1" viewBox="0 0 894 1104" width="894px" zoomAndPan="magnify"><defs><filter height="300%" id="f2j0zknq28t10" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="439" x="223.75" y="26.708">PSC Discrepancy Parser Lambda Activity Diagram</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="449.25" y="47.6611"/><path d="M331,51.9063 L331,68.0391 L311,72.0391 L331,76.0391 L331,92.1719 A0,0 0 0 0 331,92.1719 L478,92.1719 A0,0 0 0 0 478,92.1719 L478,61.9063 L468,51.9063 L331,51.9063 A0,0 0 0 0 331,51.9063 " fill="#FBFB77" filter="url(#f2j0zknq28t10)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M468,51.9063 L468,61.9063 L478,61.9063 L468,51.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="342.5" cy="64.5391" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="348" y="68.9731">email saved to S3</text><ellipse cx="342.5" cy="79.6719" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="348" y="84.106">Lambda triggered</text><ellipse cx="301" cy="72.0391" fill="#000000" filter="url(#f2j0zknq28t10)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><path d="M384.5,102.1719 L384.5,141.0039 L364.5,145.0039 L384.5,149.0039 L384.5,187.8359 A0,0 0 0 0 384.5,187.8359 L882.5,187.8359 A0,0 0 0 0 882.5,187.8359 L882.5,112.1719 L872.5,102.1719 L384.5,102.1719 A0,0 0 0 0 384.5,102.1719 " fill="#FBFB77" filter="url(#f2j0zknq28t10)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M872.5,102.1719 L872.5,112.1719 L882.5,112.1719 L872.5,102.1719 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="396" cy="114.8047" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="401.5" y="119.2388">parse file as email</text><ellipse cx="396" cy="129.9375" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="401.5" y="134.3716">check that it is is multipart/mixed</text><ellipse cx="396" cy="145.0703" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="401.5" y="149.5044">iterate over the parts lookikng for an attachment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="477" x="390.5" y="164.6372">* look for the first attachment with a *.CSV filename and BASE64 encoding</text><ellipse cx="396" cy="175.3359" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="401.5" y="179.77">decode that attachment using BASE64 and return it</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="237.5" y="121.0352"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="107" x="247.5" y="142.1738">Read email using</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="78" x="247.5" y="156.1426">CsvExtractor</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="219.5,207.8359,382.5,207.8359,394.5,219.8359,382.5,231.8359,219.5,231.8359,207.5,219.8359,219.5,207.8359" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="163" x="219.5" y="223.644">attachment can be extracted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="193.5" y="217.2417">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="394.5" y="217.2417">yes</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="10" y="241.8359"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="20" y="262.9746">note failure</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="481.5" y="241.8359"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="491.5" y="262.9746">Process attachment using</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="491.5" y="276.9434">CsvProcessor</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="523,309.7734,625,309.7734,637,321.7734,625,333.7734,523,333.7734,511,321.7734,523,309.7734" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="102" x="523" y="325.5815">can parse as CSV</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="491" y="319.1792">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="637" y="319.1792">no</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="325.5" y="391.7734"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="184" x="335.5" y="412.9121">create PscDiscrepancySurvey</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="290.5,445.7422,564.5,445.7422,576.5,457.7422,564.5,469.7422,290.5,469.7422,278.5,457.7422,290.5,445.7422" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="274" x="290.5" y="461.5503">can read CSV and create PscDiscrepancySurvey</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="258.5" y="455.1479">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="576.5" y="455.1479">no</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="253" x="142" y="479.7422"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="233" x="152" y="500.8809">Invoke CsvProcessorListener callback</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="261" x="138" y="533.7109"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="241" x="148" y="554.8496">Convert PscDiscrepancySurvey to JSON</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="217" y="587.6797"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="83" x="227" y="608.8184">Sanitise JSON</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="233" x="152" y="641.6484"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="213" x="162" y="662.7871">POST JSON to configured endpoint</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="222.5" y="744.0195"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="232.5" y="765.1582">note failure</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="211,695.6172,326,695.6172,338,707.6172,326,719.6172,211,719.6172,199,707.6172,211,695.6172" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="272.5" y="729.8276">failed</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="115" x="211" y="711.4253">test POST response</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="268.5,797.9883,280.5,809.9883,268.5,821.9883,256.5,809.9883,268.5,797.9883" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="540.5" y="479.7422"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="550.5" y="500.8809">note failure</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="427.5,827.9883,439.5,839.9883,427.5,851.9883,415.5,839.9883,427.5,827.9883" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="358.5,343.7734,496.5,343.7734,508.5,355.7734,496.5,367.7734,358.5,367.7734,346.5,355.7734,358.5,343.7734" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="138" x="358.5" y="359.5815">while more CSV records</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="674.5" y="343.7734"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="684.5" y="364.9121">note failure</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="574,879.9883,586,891.9883,574,903.9883,562,891.9883,574,879.9883" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="301,909.9883,313,921.9883,301,933.9883,289,921.9883,301,909.9883" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="265,953.9883,337,953.9883,349,965.9883,337,977.9883,265,977.9883,253,965.9883,265,953.9883" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="265" y="969.7964">failure noted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="181" y="963.394">failure noted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="200" x="349" y="963.394">all CSV parsed and sent over REST</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="170" x="112.25" y="987.9883"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="150" x="122.25" y="1009.127">move file to failed folder</text><rect fill="#FEFECE" filter="url(#f2j0zknq28t10)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="205" x="302.25" y="987.9883"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="185" x="312.25" y="1009.127">move file to succeeded folder</text><polygon fill="#FEFECE" filter="url(#f2j0zknq28t10)" points="301,1027.957,313,1039.957,301,1051.957,289,1039.957,301,1027.957" style="stroke: #A80036; stroke-width: 1.5;"/><ellipse cx="301" cy="1082.957" fill="#FFFFFF" filter="url(#f2j0zknq28t10)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="301" cy="1082.957" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="301" x2="301" y1="82.0391" y2="121.0352"/><polygon fill="#A80036" points="297,111.0352,301,121.0352,305,111.0352,301,115.0352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="513.7109" y2="533.7109"/><polygon fill="#A80036" points="264.5,523.7109,268.5,533.7109,272.5,523.7109,268.5,527.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="567.6797" y2="587.6797"/><polygon fill="#A80036" points="264.5,577.6797,268.5,587.6797,272.5,577.6797,268.5,581.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="621.6484" y2="641.6484"/><polygon fill="#A80036" points="264.5,631.6484,268.5,641.6484,272.5,631.6484,268.5,635.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="719.6172" y2="744.0195"/><polygon fill="#A80036" points="264.5,734.0195,268.5,744.0195,272.5,734.0195,268.5,738.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="338" x2="350" y1="707.6172" y2="707.6172"/><polygon fill="#A80036" points="346,751.0039,350,761.0039,354,751.0039,350,755.0039" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="707.6172" y2="809.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="280.5" y1="809.9883" y2="809.9883"/><polygon fill="#A80036" points="290.5,805.9883,280.5,809.9883,290.5,813.9883,286.5,809.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="777.9883" y2="797.9883"/><polygon fill="#A80036" points="264.5,787.9883,268.5,797.9883,272.5,787.9883,268.5,791.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="675.6172" y2="695.6172"/><polygon fill="#A80036" points="264.5,685.6172,268.5,695.6172,272.5,685.6172,268.5,689.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="278.5" x2="268.5" y1="457.7422" y2="457.7422"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="457.7422" y2="479.7422"/><polygon fill="#A80036" points="264.5,469.7422,268.5,479.7422,272.5,469.7422,268.5,473.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="576.5" x2="586.5" y1="457.7422" y2="457.7422"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="586.5" x2="586.5" y1="457.7422" y2="479.7422"/><polygon fill="#A80036" points="582.5,469.7422,586.5,479.7422,590.5,469.7422,586.5,473.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="268.5" y1="821.9883" y2="839.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="268.5" x2="415.5" y1="839.9883" y2="839.9883"/><polygon fill="#A80036" points="405.5,835.9883,415.5,839.9883,405.5,843.9883,409.5,839.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="586.5" x2="586.5" y1="513.7109" y2="839.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="586.5" x2="439.5" y1="839.9883" y2="839.9883"/><polygon fill="#A80036" points="449.5,835.9883,439.5,839.9883,449.5,843.9883,445.5,839.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="427.5" x2="427.5" y1="425.7422" y2="445.7422"/><polygon fill="#A80036" points="423.5,435.7422,427.5,445.7422,431.5,435.7422,427.5,439.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="427.5" x2="427.5" y1="367.7734" y2="391.7734"/><polygon fill="#A80036" points="423.5,381.7734,427.5,391.7734,431.5,381.7734,427.5,385.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="427.5" x2="427.5" y1="851.9883" y2="861.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="427.5" x2="654.5" y1="861.9883" y2="861.9883"/><polygon fill="#A80036" points="650.5,614.582,654.5,604.582,658.5,614.582,654.5,610.582" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="654.5" x2="654.5" y1="355.7734" y2="861.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="654.5" x2="508.5" y1="355.7734" y2="355.7734"/><polygon fill="#A80036" points="518.5,351.7734,508.5,355.7734,518.5,359.7734,514.5,355.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="346.5" x2="116" y1="355.7734" y2="355.7734"/><polygon fill="#A80036" points="112,609.582,116,619.582,120,609.582,116,613.582" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="116" x2="116" y1="355.7734" y2="891.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="116" x2="562" y1="891.9883" y2="891.9883"/><polygon fill="#A80036" points="552,887.9883,562,891.9883,552,895.9883,556,891.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="511" x2="427.5" y1="321.7734" y2="321.7734"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="427.5" x2="427.5" y1="321.7734" y2="343.7734"/><polygon fill="#A80036" points="423.5,333.7734,427.5,343.7734,431.5,333.7734,427.5,337.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="637" x2="720.5" y1="321.7734" y2="321.7734"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="720.5" x2="720.5" y1="321.7734" y2="343.7734"/><polygon fill="#A80036" points="716.5,333.7734,720.5,343.7734,724.5,333.7734,720.5,337.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="720.5" x2="720.5" y1="377.7422" y2="891.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="720.5" x2="586" y1="891.9883" y2="891.9883"/><polygon fill="#A80036" points="596,887.9883,586,891.9883,596,895.9883,592,891.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="574" x2="574" y1="289.7734" y2="309.7734"/><polygon fill="#A80036" points="570,299.7734,574,309.7734,578,299.7734,574,303.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="207.5" x2="56" y1="219.8359" y2="219.8359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="56" y1="219.8359" y2="241.8359"/><polygon fill="#A80036" points="52,231.8359,56,241.8359,60,231.8359,56,235.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="394.5" x2="574" y1="219.8359" y2="219.8359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="574" x2="574" y1="219.8359" y2="241.8359"/><polygon fill="#A80036" points="570,231.8359,574,241.8359,578,231.8359,574,235.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="56" y1="275.8047" y2="921.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="289" y1="921.9883" y2="921.9883"/><polygon fill="#A80036" points="279,917.9883,289,921.9883,279,925.9883,283,921.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="574" x2="574" y1="903.9883" y2="921.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="574" x2="313" y1="921.9883" y2="921.9883"/><polygon fill="#A80036" points="323,917.9883,313,921.9883,323,925.9883,319,921.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="301" x2="301" y1="168.9727" y2="207.8359"/><polygon fill="#A80036" points="297,197.8359,301,207.8359,305,197.8359,301,201.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="253" x2="197.25" y1="965.9883" y2="965.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197.25" x2="197.25" y1="965.9883" y2="987.9883"/><polygon fill="#A80036" points="193.25,977.9883,197.25,987.9883,201.25,977.9883,197.25,981.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="349" x2="404.75" y1="965.9883" y2="965.9883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="404.75" x2="404.75" y1="965.9883" y2="987.9883"/><polygon fill="#A80036" points="400.75,977.9883,404.75,987.9883,408.75,977.9883,404.75,981.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197.25" x2="197.25" y1="1021.957" y2="1039.957"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197.25" x2="289" y1="1039.957" y2="1039.957"/><polygon fill="#A80036" points="279,1035.957,289,1039.957,279,1043.957,283,1039.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="404.75" x2="404.75" y1="1021.957" y2="1039.957"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="404.75" x2="313" y1="1039.957" y2="1039.957"/><polygon fill="#A80036" points="323,1035.957,313,1039.957,323,1043.957,319,1039.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="301" x2="301" y1="933.9883" y2="953.9883"/><polygon fill="#A80036" points="297,943.9883,301,953.9883,305,943.9883,301,947.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="301" x2="301" y1="1051.957" y2="1071.957"/><polygon fill="#A80036" points="297,1061.957,301,1071.957,305,1061.957,301,1065.957" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[c149d5c5549563f1f9c9257e78a7af3c]
@startuml
title PSC Discrepancy Parser Lambda Activity Diagram \n

start
note right
    * email saved to S3
    * Lambda triggered
endnote
:Read email using\nCsvExtractor;
note right
    * parse file as email
    * check that it is is multipart/mixed
    * iterate over the parts lookikng for an attachment
    * look for the first attachment with a *.CSV filename and BASE64 encoding
    * decode that attachment using BASE64 and return it
end note

if (attachment can be extracted) then (no)
  :note failure;
else (yes)
  :Process attachment using\nCsvProcessor;
  if (can parse as CSV) then (yes)
    while (while more CSV records)
        :create PscDiscrepancySurvey;
        if (can read CSV and create PscDiscrepancySurvey) then (yes)
            :Invoke CsvProcessorListener callback;
            :Convert PscDiscrepancySurvey to JSON;
            :Sanitise JSON;
            :POST JSON to configured endpoint;
            if (test POST response) then (failed)
                :note failure;
            endif
        else (no)
            :note failure;
        endif
    endwhile
  else (no)
	:note failure;
  endif
endif
if (failure noted) then (failure noted)
    :move file to failed folder;
else (all CSV parsed and sent over REST)
    :move file to succeeded folder;
endif


stop
@enduml

PlantUML version 1.2019.13(Tue Dec 10 17:18:29 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>