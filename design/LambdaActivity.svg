<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="971px" preserveAspectRatio="none" style="width:905px;height:971px;" version="1.1" viewBox="0 0 905 971" width="905px" zoomAndPan="magnify"><defs><filter height="300%" id="f1lmaqdgjmw9o5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="439" x="229.375" y="26.708">PSC Discrepancy Parser Lambda Activity Diagram</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="454.875" y="47.6611"/><path d="M342.25,51.9063 L342.25,68.0391 L322.25,72.0391 L342.25,76.0391 L342.25,92.1719 A0,0 0 0 0 342.25,92.1719 L489.25,92.1719 A0,0 0 0 0 489.25,92.1719 L489.25,61.9063 L479.25,51.9063 L342.25,51.9063 A0,0 0 0 0 342.25,51.9063 " fill="#FBFB77" filter="url(#f1lmaqdgjmw9o5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M479.25,51.9063 L479.25,61.9063 L489.25,61.9063 L479.25,51.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="353.75" cy="64.5391" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="359.25" y="68.9731">email saved to S3</text><ellipse cx="353.75" cy="79.6719" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="359.25" y="84.106">Lambda triggered</text><ellipse cx="312.25" cy="72.0391" fill="#000000" filter="url(#f1lmaqdgjmw9o5)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><path d="M395.75,102.1719 L395.75,141.0039 L375.75,145.0039 L395.75,149.0039 L395.75,187.8359 A0,0 0 0 0 395.75,187.8359 L893.75,187.8359 A0,0 0 0 0 893.75,187.8359 L893.75,112.1719 L883.75,102.1719 L395.75,102.1719 A0,0 0 0 0 395.75,102.1719 " fill="#FBFB77" filter="url(#f1lmaqdgjmw9o5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M883.75,102.1719 L883.75,112.1719 L893.75,112.1719 L883.75,102.1719 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="407.25" cy="114.8047" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="412.75" y="119.2388">parse file as email</text><ellipse cx="407.25" cy="129.9375" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="412.75" y="134.3716">check that it is is multipart/mixed</text><ellipse cx="407.25" cy="145.0703" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="412.75" y="149.5044">iterate over the parts lookikng for an attachment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="477" x="401.75" y="164.6372">* look for the first attachment with a *.CSV filename and BASE64 encoding</text><ellipse cx="407.25" cy="175.3359" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="412.75" y="179.77">decode that attachment using BASE64 and return it</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="248.75" y="121.0352"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="107" x="258.75" y="142.1738">Read email using</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="65" x="258.75" y="156.1426">MailParser</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="230.75,207.8359,393.75,207.8359,405.75,219.8359,393.75,231.8359,230.75,231.8359,218.75,219.8359,230.75,207.8359" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="163" x="230.75" y="223.644">attachment can be extracted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="204.75" y="217.2417">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="405.75" y="217.2417">yes</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="10" y="241.8359"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="20" y="262.9746">note failure</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="243" x="475" y="241.8359"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="485" y="262.9746">Process attachment using</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="223" x="485" y="276.9434">PscDiscrepancySurveyCsvProcessor</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="545.5,309.7734,647.5,309.7734,659.5,321.7734,647.5,333.7734,545.5,333.7734,533.5,321.7734,545.5,309.7734" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="102" x="545.5" y="325.5815">can parse as CSV</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="513.5" y="319.1792">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="659.5" y="319.1792">no</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="348" y="391.7734"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="184" x="358" y="412.9121">create PscDiscrepancySurvey</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="313,445.7422,587,445.7422,599,457.7422,587,469.7422,313,469.7422,301,457.7422,313,445.7422" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="274" x="313" y="461.5503">can read CSV and create PscDiscrepancySurvey</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="281" y="455.1479">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="599" y="455.1479">no</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="306" x="138" y="479.7422"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="286" x="148" y="500.8809">Invoke PscDiscrepancyFoundListener callback</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="236" x="148" y="514.8496">which will POST PscDiscrepancySurvey</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="245" y="610.6484"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="255" y="631.7871">note failure</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="233.5,562.2461,348.5,562.2461,360.5,574.2461,348.5,586.2461,233.5,586.2461,221.5,574.2461,233.5,562.2461" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="295" y="596.4565">failed</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="115" x="233.5" y="578.0542">test POST response</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="291,664.6172,303,676.6172,291,688.6172,279,676.6172,291,664.6172" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="563" y="479.7422"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="573" y="500.8809">note failure</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="450,694.6172,462,706.6172,450,718.6172,438,706.6172,450,694.6172" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="381,343.7734,519,343.7734,531,355.7734,519,367.7734,381,367.7734,369,355.7734,381,343.7734" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="138" x="381" y="359.5815">while more CSV records</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="697" y="343.7734"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="707" y="364.9121">note failure</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="596.5,746.6172,608.5,758.6172,596.5,770.6172,584.5,758.6172,596.5,746.6172" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="312.25,776.6172,324.25,788.6172,312.25,800.6172,300.25,788.6172,312.25,776.6172" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="276.25,820.6172,348.25,820.6172,360.25,832.6172,348.25,844.6172,276.25,844.6172,264.25,832.6172,276.25,820.6172" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="276.25" y="836.4253">failure noted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="192.25" y="830.0229">failure noted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="200" x="360.25" y="830.0229">all CSV parsed and sent over REST</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="170" x="123.5" y="854.6172"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="150" x="133.5" y="875.7559">move file to failed folder</text><rect fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="205" x="313.5" y="854.6172"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="185" x="323.5" y="875.7559">move file to succeeded folder</text><polygon fill="#FEFECE" filter="url(#f1lmaqdgjmw9o5)" points="312.25,894.5859,324.25,906.5859,312.25,918.5859,300.25,906.5859,312.25,894.5859" style="stroke: #A80036; stroke-width: 1.5;"/><ellipse cx="312.25" cy="949.5859" fill="#FFFFFF" filter="url(#f1lmaqdgjmw9o5)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="312.25" cy="949.5859" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="312.25" x2="312.25" y1="82.0391" y2="121.0352"/><polygon fill="#A80036" points="308.25,111.0352,312.25,121.0352,316.25,111.0352,312.25,115.0352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="291" y1="586.2461" y2="610.6484"/><polygon fill="#A80036" points="287,600.6484,291,610.6484,295,600.6484,291,604.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="360.5" x2="372.5" y1="574.2461" y2="574.2461"/><polygon fill="#A80036" points="368.5,617.6328,372.5,627.6328,376.5,617.6328,372.5,621.6328" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="372.5" x2="372.5" y1="574.2461" y2="676.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="372.5" x2="303" y1="676.6172" y2="676.6172"/><polygon fill="#A80036" points="313,672.6172,303,676.6172,313,680.6172,309,676.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="291" y1="644.6172" y2="664.6172"/><polygon fill="#A80036" points="287,654.6172,291,664.6172,295,654.6172,291,658.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="291" y1="527.6797" y2="562.2461"/><polygon fill="#A80036" points="287,552.2461,291,562.2461,295,552.2461,291,556.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="301" x2="291" y1="457.7422" y2="457.7422"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="291" y1="457.7422" y2="479.7422"/><polygon fill="#A80036" points="287,469.7422,291,479.7422,295,469.7422,291,473.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="599" x2="609" y1="457.7422" y2="457.7422"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="609" x2="609" y1="457.7422" y2="479.7422"/><polygon fill="#A80036" points="605,469.7422,609,479.7422,613,469.7422,609,473.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="291" y1="688.6172" y2="706.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="438" y1="706.6172" y2="706.6172"/><polygon fill="#A80036" points="428,702.6172,438,706.6172,428,710.6172,432,706.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="609" x2="609" y1="513.7109" y2="706.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="609" x2="462" y1="706.6172" y2="706.6172"/><polygon fill="#A80036" points="472,702.6172,462,706.6172,472,710.6172,468,706.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="450" x2="450" y1="425.7422" y2="445.7422"/><polygon fill="#A80036" points="446,435.7422,450,445.7422,454,435.7422,450,439.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="450" x2="450" y1="367.7734" y2="391.7734"/><polygon fill="#A80036" points="446,381.7734,450,391.7734,454,381.7734,450,385.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="450" x2="450" y1="718.6172" y2="728.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="450" x2="677" y1="728.6172" y2="728.6172"/><polygon fill="#A80036" points="673,547.6797,677,537.6797,681,547.6797,677,543.6797" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="677" x2="677" y1="355.7734" y2="728.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="677" x2="531" y1="355.7734" y2="355.7734"/><polygon fill="#A80036" points="541,351.7734,531,355.7734,541,359.7734,537,355.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="369" x2="116" y1="355.7734" y2="355.7734"/><polygon fill="#A80036" points="112,542.6797,116,552.6797,120,542.6797,116,546.6797" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="116" x2="116" y1="355.7734" y2="758.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="116" x2="584.5" y1="758.6172" y2="758.6172"/><polygon fill="#A80036" points="574.5,754.6172,584.5,758.6172,574.5,762.6172,578.5,758.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="533.5" x2="450" y1="321.7734" y2="321.7734"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="450" x2="450" y1="321.7734" y2="343.7734"/><polygon fill="#A80036" points="446,333.7734,450,343.7734,454,333.7734,450,337.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="659.5" x2="743" y1="321.7734" y2="321.7734"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="743" x2="743" y1="321.7734" y2="343.7734"/><polygon fill="#A80036" points="739,333.7734,743,343.7734,747,333.7734,743,337.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="743" x2="743" y1="377.7422" y2="758.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="743" x2="608.5" y1="758.6172" y2="758.6172"/><polygon fill="#A80036" points="618.5,754.6172,608.5,758.6172,618.5,762.6172,614.5,758.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="596.5" x2="596.5" y1="289.7734" y2="309.7734"/><polygon fill="#A80036" points="592.5,299.7734,596.5,309.7734,600.5,299.7734,596.5,303.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="218.75" x2="56" y1="219.8359" y2="219.8359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="56" y1="219.8359" y2="241.8359"/><polygon fill="#A80036" points="52,231.8359,56,241.8359,60,231.8359,56,235.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="405.75" x2="596.5" y1="219.8359" y2="219.8359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="596.5" x2="596.5" y1="219.8359" y2="241.8359"/><polygon fill="#A80036" points="592.5,231.8359,596.5,241.8359,600.5,231.8359,596.5,235.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="56" y1="275.8047" y2="788.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="300.25" y1="788.6172" y2="788.6172"/><polygon fill="#A80036" points="290.25,784.6172,300.25,788.6172,290.25,792.6172,294.25,788.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="596.5" x2="596.5" y1="770.6172" y2="788.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="596.5" x2="324.25" y1="788.6172" y2="788.6172"/><polygon fill="#A80036" points="334.25,784.6172,324.25,788.6172,334.25,792.6172,330.25,788.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="312.25" x2="312.25" y1="168.9727" y2="207.8359"/><polygon fill="#A80036" points="308.25,197.8359,312.25,207.8359,316.25,197.8359,312.25,201.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="264.25" x2="208.5" y1="832.6172" y2="832.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="208.5" x2="208.5" y1="832.6172" y2="854.6172"/><polygon fill="#A80036" points="204.5,844.6172,208.5,854.6172,212.5,844.6172,208.5,848.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="360.25" x2="416" y1="832.6172" y2="832.6172"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="416" x2="416" y1="832.6172" y2="854.6172"/><polygon fill="#A80036" points="412,844.6172,416,854.6172,420,844.6172,416,848.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="208.5" x2="208.5" y1="888.5859" y2="906.5859"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="208.5" x2="300.25" y1="906.5859" y2="906.5859"/><polygon fill="#A80036" points="290.25,902.5859,300.25,906.5859,290.25,910.5859,294.25,906.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="416" x2="416" y1="888.5859" y2="906.5859"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="416" x2="324.25" y1="906.5859" y2="906.5859"/><polygon fill="#A80036" points="334.25,902.5859,324.25,906.5859,334.25,910.5859,330.25,906.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="312.25" x2="312.25" y1="800.6172" y2="820.6172"/><polygon fill="#A80036" points="308.25,810.6172,312.25,820.6172,316.25,810.6172,312.25,814.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="312.25" x2="312.25" y1="918.5859" y2="938.5859"/><polygon fill="#A80036" points="308.25,928.5859,312.25,938.5859,316.25,928.5859,312.25,932.5859" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[6889037471db8a7efc732887d2f6c4a2]
@startuml
title PSC Discrepancy Parser Lambda Activity Diagram \n

start
note right
    * email saved to S3
    * Lambda triggered
endnote
:Read email using\nMailParser;
note right
    * parse file as email
    * check that it is is multipart/mixed
    * iterate over the parts lookikng for an attachment
    * look for the first attachment with a *.CSV filename and BASE64 encoding
    * decode that attachment using BASE64 and return it
end note

if (attachment can be extracted) then (no)
  :note failure;
else (yes)
  :Process attachment using\nPscDiscrepancySurveyCsvProcessor;
  if (can parse as CSV) then (yes)
    while (while more CSV records)
        :create PscDiscrepancySurvey;
        if (can read CSV and create PscDiscrepancySurvey) then (yes)
            :Invoke PscDiscrepancyFoundListener callback\nwhich will POST PscDiscrepancySurvey;
            if (test POST response) then (failed)
                :note failure;
            endif
        else (no)
            :note failure;
        endif
    endwhile
  else (no)
	:note failure;
  endif
endif
if (failure noted) then (failure noted)
    :move file to failed folder;
else (all CSV parsed and sent over REST)
    :move file to succeeded folder;
endif


stop
@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>