<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1038px" preserveAspectRatio="none" style="width:894px;height:1038px;" version="1.1" viewBox="0 0 894 1038" width="894px" zoomAndPan="magnify"><defs><filter height="300%" id="f1n7qvarbsxzr7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="439" x="223.625" y="26.708">PSC Discrepancy Parser Lambda Activity Diagram</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="449.125" y="47.6611"/><ellipse cx="300.75" cy="61.9063" fill="#000000" filter="url(#f1n7qvarbsxzr7)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="235.25" y="91.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="245.25" y="113.0449">email saved to S3</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="235.25" y="145.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="245.25" y="167.0137">Lambda triggered</text><path d="M384.25,189.8438 L384.25,228.6758 L364.25,232.6758 L384.25,236.6758 L384.25,275.5078 A0,0 0 0 0 384.25,275.5078 L882.25,275.5078 A0,0 0 0 0 882.25,275.5078 L882.25,199.8438 L872.25,189.8438 L384.25,189.8438 A0,0 0 0 0 384.25,189.8438 " fill="#FBFB77" filter="url(#f1n7qvarbsxzr7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M872.25,189.8438 L872.25,199.8438 L882.25,199.8438 L872.25,189.8438 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><ellipse cx="395.75" cy="202.4766" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="401.25" y="206.9106">parse file as email</text><ellipse cx="395.75" cy="217.6094" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="401.25" y="222.0435">check that it is is multipart/mixed</text><ellipse cx="395.75" cy="232.7422" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="401.25" y="237.1763">iterate over the parts lookikng for an attachment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="477" x="390.25" y="252.3091">* look for the first attachment with a *.CSV filename and BASE64 encoding</text><ellipse cx="395.75" cy="263.0078" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="401.25" y="267.4419">decode that attachment using BASE64 and return it</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="237.25" y="208.707"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="107" x="247.25" y="229.8457">Read email using</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="65" x="247.25" y="243.8145">MailParser</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="219.25,295.5078,382.25,295.5078,394.25,307.5078,382.25,319.5078,219.25,319.5078,207.25,307.5078,219.25,295.5078" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="163" x="219.25" y="311.3159">attachment can be extracted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="193.25" y="304.9136">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="394.25" y="304.9136">yes</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="10" y="329.5078"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="20" y="350.6465">note failure</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="243" x="435.75" y="329.5078"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="445.75" y="350.6465">Process attachment using</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="223" x="445.75" y="364.6152">PscDiscrepancySurveyCsvProcessor</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="485.25,397.4453,629.25,397.4453,641.25,409.4453,629.25,421.4453,485.25,421.4453,473.25,409.4453,485.25,397.4453" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="144" x="485.25" y="413.2534">can parse as CSV parser</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="453.25" y="406.8511">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="641.25" y="406.8511">no</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="308.75" y="479.4453"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="184" x="318.75" y="500.584">create PscDiscrepancySurvey</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="273.75,533.4141,547.75,533.4141,559.75,545.4141,547.75,557.4141,273.75,557.4141,261.75,545.4141,273.75,533.4141" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="274" x="273.75" y="549.2222">can read CSV and create PscDiscrepancySurvey</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="241.75" y="542.8198">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="559.75" y="542.8198">no</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="195" x="154.25" y="567.4141"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="175" x="164.25" y="588.5527">POST PscDiscrepancySurvey</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="205.75" y="677.3672"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="215.75" y="698.5059">note failure</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="218.75,628.9648,284.75,628.9648,296.75,640.9648,284.75,652.9648,218.75,652.9648,206.75,640.9648,218.75,628.9648" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="255.75" y="663.1753">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="218.75" y="644.7729">POST failed</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="251.75,731.3359,263.75,743.3359,251.75,755.3359,239.75,743.3359,251.75,731.3359" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="523.75" y="567.4141"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="533.75" y="588.5527">note failure</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="410.75,761.3359,422.75,773.3359,410.75,785.3359,398.75,773.3359,410.75,761.3359" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="358.25,431.4453,463.25,431.4453,475.25,443.4453,463.25,455.4453,358.25,455.4453,346.25,443.4453,358.25,431.4453" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="105" x="358.25" y="447.2534">more CSV records</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="657.75" y="431.4453"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="667.75" y="452.584">note failure</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="557.25,813.3359,569.25,825.3359,557.25,837.3359,545.25,825.3359,557.25,813.3359" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="300.75,843.3359,312.75,855.3359,300.75,867.3359,288.75,855.3359,300.75,843.3359" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="264.75,887.3359,336.75,887.3359,348.75,899.3359,336.75,911.3359,264.75,911.3359,252.75,899.3359,264.75,887.3359" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="264.75" y="903.144">failure noted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="232.75" y="896.7417">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="348.75" y="896.7417">no</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="170" x="112" y="921.3359"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="150" x="122" y="942.4746">move file to failed folder</text><rect fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="205" x="302" y="921.3359"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="185" x="312" y="942.4746">move file to succeeded folder</text><polygon fill="#FEFECE" filter="url(#f1n7qvarbsxzr7)" points="300.75,961.3047,312.75,973.3047,300.75,985.3047,288.75,973.3047,300.75,961.3047" style="stroke: #A80036; stroke-width: 1.5;"/><ellipse cx="300.75" cy="1016.3047" fill="#FFFFFF" filter="url(#f1n7qvarbsxzr7)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="300.75" cy="1016.3047" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="300.75" x2="300.75" y1="71.9063" y2="91.9063"/><polygon fill="#A80036" points="296.75,81.9063,300.75,91.9063,304.75,81.9063,300.75,85.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="300.75" x2="300.75" y1="125.875" y2="145.875"/><polygon fill="#A80036" points="296.75,135.875,300.75,145.875,304.75,135.875,300.75,139.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="300.75" x2="300.75" y1="179.8438" y2="208.707"/><polygon fill="#A80036" points="296.75,198.707,300.75,208.707,304.75,198.707,300.75,202.707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="251.75" x2="251.75" y1="652.9648" y2="677.3672"/><polygon fill="#A80036" points="247.75,667.3672,251.75,677.3672,255.75,667.3672,251.75,671.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="296.75" x2="308.75" y1="640.9648" y2="640.9648"/><polygon fill="#A80036" points="304.75,684.3516,308.75,694.3516,312.75,684.3516,308.75,688.3516" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="308.75" x2="308.75" y1="640.9648" y2="743.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="308.75" x2="263.75" y1="743.3359" y2="743.3359"/><polygon fill="#A80036" points="273.75,739.3359,263.75,743.3359,273.75,747.3359,269.75,743.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="251.75" x2="251.75" y1="711.3359" y2="731.3359"/><polygon fill="#A80036" points="247.75,721.3359,251.75,731.3359,255.75,721.3359,251.75,725.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="251.75" x2="251.75" y1="601.3828" y2="628.9648"/><polygon fill="#A80036" points="247.75,618.9648,251.75,628.9648,255.75,618.9648,251.75,622.9648" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="261.75" x2="251.75" y1="545.4141" y2="545.4141"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="251.75" x2="251.75" y1="545.4141" y2="567.4141"/><polygon fill="#A80036" points="247.75,557.4141,251.75,567.4141,255.75,557.4141,251.75,561.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="559.75" x2="569.75" y1="545.4141" y2="545.4141"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="569.75" x2="569.75" y1="545.4141" y2="567.4141"/><polygon fill="#A80036" points="565.75,557.4141,569.75,567.4141,573.75,557.4141,569.75,561.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="251.75" x2="251.75" y1="755.3359" y2="773.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="251.75" x2="398.75" y1="773.3359" y2="773.3359"/><polygon fill="#A80036" points="388.75,769.3359,398.75,773.3359,388.75,777.3359,392.75,773.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="569.75" x2="569.75" y1="601.3828" y2="773.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="569.75" x2="422.75" y1="773.3359" y2="773.3359"/><polygon fill="#A80036" points="432.75,769.3359,422.75,773.3359,432.75,777.3359,428.75,773.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="410.75" x2="410.75" y1="513.4141" y2="533.4141"/><polygon fill="#A80036" points="406.75,523.4141,410.75,533.4141,414.75,523.4141,410.75,527.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="410.75" x2="410.75" y1="455.4453" y2="479.4453"/><polygon fill="#A80036" points="406.75,469.4453,410.75,479.4453,414.75,469.4453,410.75,473.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="410.75" x2="410.75" y1="785.3359" y2="795.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="410.75" x2="637.75" y1="795.3359" y2="795.3359"/><polygon fill="#A80036" points="633.75,621.3828,637.75,611.3828,641.75,621.3828,637.75,617.3828" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="637.75" x2="637.75" y1="443.4453" y2="795.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="637.75" x2="475.25" y1="443.4453" y2="443.4453"/><polygon fill="#A80036" points="485.25,439.4453,475.25,443.4453,485.25,447.4453,481.25,443.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="346.25" x2="132.25" y1="443.4453" y2="443.4453"/><polygon fill="#A80036" points="128.25,616.3828,132.25,626.3828,136.25,616.3828,132.25,620.3828" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="132.25" x2="132.25" y1="443.4453" y2="825.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="132.25" x2="545.25" y1="825.3359" y2="825.3359"/><polygon fill="#A80036" points="535.25,821.3359,545.25,825.3359,535.25,829.3359,539.25,825.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="473.25" x2="410.75" y1="409.4453" y2="409.4453"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="410.75" x2="410.75" y1="409.4453" y2="431.4453"/><polygon fill="#A80036" points="406.75,421.4453,410.75,431.4453,414.75,421.4453,410.75,425.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="641.25" x2="703.75" y1="409.4453" y2="409.4453"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="703.75" x2="703.75" y1="409.4453" y2="431.4453"/><polygon fill="#A80036" points="699.75,421.4453,703.75,431.4453,707.75,421.4453,703.75,425.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="703.75" x2="703.75" y1="465.4141" y2="825.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="703.75" x2="569.25" y1="825.3359" y2="825.3359"/><polygon fill="#A80036" points="579.25,821.3359,569.25,825.3359,579.25,829.3359,575.25,825.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="557.25" x2="557.25" y1="377.4453" y2="397.4453"/><polygon fill="#A80036" points="553.25,387.4453,557.25,397.4453,561.25,387.4453,557.25,391.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="207.25" x2="56" y1="307.5078" y2="307.5078"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="56" y1="307.5078" y2="329.5078"/><polygon fill="#A80036" points="52,319.5078,56,329.5078,60,319.5078,56,323.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="394.25" x2="557.25" y1="307.5078" y2="307.5078"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="557.25" x2="557.25" y1="307.5078" y2="329.5078"/><polygon fill="#A80036" points="553.25,319.5078,557.25,329.5078,561.25,319.5078,557.25,323.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="56" y1="363.4766" y2="855.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="56" x2="288.75" y1="855.3359" y2="855.3359"/><polygon fill="#A80036" points="278.75,851.3359,288.75,855.3359,278.75,859.3359,282.75,855.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="557.25" x2="557.25" y1="837.3359" y2="855.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="557.25" x2="312.75" y1="855.3359" y2="855.3359"/><polygon fill="#A80036" points="322.75,851.3359,312.75,855.3359,322.75,859.3359,318.75,855.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="300.75" x2="300.75" y1="256.6445" y2="295.5078"/><polygon fill="#A80036" points="296.75,285.5078,300.75,295.5078,304.75,285.5078,300.75,289.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="252.75" x2="197" y1="899.3359" y2="899.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197" x2="197" y1="899.3359" y2="921.3359"/><polygon fill="#A80036" points="193,911.3359,197,921.3359,201,911.3359,197,915.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="348.75" x2="404.5" y1="899.3359" y2="899.3359"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="404.5" x2="404.5" y1="899.3359" y2="921.3359"/><polygon fill="#A80036" points="400.5,911.3359,404.5,921.3359,408.5,911.3359,404.5,915.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197" x2="197" y1="955.3047" y2="973.3047"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197" x2="288.75" y1="973.3047" y2="973.3047"/><polygon fill="#A80036" points="278.75,969.3047,288.75,973.3047,278.75,977.3047,282.75,973.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="404.5" x2="404.5" y1="955.3047" y2="973.3047"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="404.5" x2="312.75" y1="973.3047" y2="973.3047"/><polygon fill="#A80036" points="322.75,969.3047,312.75,973.3047,322.75,977.3047,318.75,973.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="300.75" x2="300.75" y1="867.3359" y2="887.3359"/><polygon fill="#A80036" points="296.75,877.3359,300.75,887.3359,304.75,877.3359,300.75,881.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="300.75" x2="300.75" y1="985.3047" y2="1005.3047"/><polygon fill="#A80036" points="296.75,995.3047,300.75,1005.3047,304.75,995.3047,300.75,999.3047" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[75ff9ebbccab3e7ce73bd5941239b721]
@startuml
title PSC Discrepancy Parser Lambda Activity Diagram \n

start

:email saved to S3;

:Lambda triggered;

:Read email using\nMailParser;
note right
    * parse file as email
    * check that it is is multipart/mixed
    * iterate over the parts lookikng for an attachment
    * look for the first attachment with a *.CSV filename and BASE64 encoding
    * decode that attachment using BASE64 and return it
end note

if (attachment can be extracted) then (no)
  :note failure;
else (yes)
  :Process attachment using\nPscDiscrepancySurveyCsvProcessor;
  if (can parse as CSV parser) then (yes)
    while (more CSV records)
        :create PscDiscrepancySurvey;
        if (can read CSV and create PscDiscrepancySurvey) then (yes)
            :POST PscDiscrepancySurvey;
            if (POST failed) then (yes)
                :note failure;
            endif
        else (no)
            :note failure;
        endif
    endwhile
  else (no)
	:note failure;
  endif
endif
if (failure noted) then (yes)
    :move file to failed folder;
else (no)
    :move file to succeeded folder;
endif


stop
@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>